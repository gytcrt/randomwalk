{{- $currentYear := now.Year }}
{{- $sinceYear := (site.Params.footer.since | default $currentYear) | int }}
{{- $yearText := printf "%d" $currentYear }}
{{- if lt $sinceYear $currentYear }}
  {{- $yearText = printf "%d-%d" $sinceYear $currentYear }}
{{- end }}
{{- $footerOwner := site.Params.footer.copyright | default site.Copyright }}
{{- if $footerOwner }}
  {{- $footerOwner = replaceRE "^\\s*(&copy;|©)\\s*" "" $footerOwner }}
  {{- $footerOwner = replaceRE "^\\d{4}([\\-–]\\d{4})?\\s*" "" $footerOwner }}
{{- end }}
{{- $emailURL := "" }}
{{- $linkedinURL := "" }}
{{- $githubURL := "" }}
{{- range site.Params.socialIcons }}
  {{- $name := lower (trim .name " ") }}
  {{- $url := trim .url " " }}
  {{- if eq $name "email" }}
    {{- if eq $url "email" }}
      {{- $emailAddress := site.Params.Email | default site.Params.MaskedEmail }}
      {{- if $emailAddress }}
        {{- $emailURL = printf "mailto:%s" $emailAddress }}
      {{- end }}
    {{- else if hasPrefix $url "mailto:" }}
      {{- $emailURL = $url }}
    {{- else if $url }}
      {{- $emailURL = printf "mailto:%s" $url }}
    {{- end }}
  {{- else if eq $name "linkedin" }}
    {{- $linkedinURL = $url }}
  {{- else if eq $name "github" }}
    {{- $githubURL = $url }}
  {{- end }}
{{- end }}

{{- if not (.Param "hideFooter") }}
<footer class="footer">
  <div class="footer-inline-links">
    {{- if $footerOwner }}
    <span>{{ printf "&copy; %s %s" $yearText $footerOwner | markdownify }}</span>
    {{- else }}
    <span>&copy; {{ $yearText }} <a href="{{ "" | absURL }}">{{ site.Title }}</a></span>
    {{- end -}}
    {{- with $emailURL }}
    <span class="footer-separator" aria-hidden="true">&middot;</span>
    <a href="{{ . }}">Email</a>
    {{- end }}
    {{- with $linkedinURL }}
    <span class="footer-separator" aria-hidden="true">&middot;</span>
    <a href="{{ . }}" target="_blank" rel="noopener noreferrer me">LinkedIn</a>
    {{- end }}
    {{- with $githubURL }}
    <span class="footer-separator" aria-hidden="true">&middot;</span>
    <a href="{{ . }}" target="_blank" rel="noopener noreferrer me">GitHub</a>
    {{- end }}
  </div>
</footer>
{{- end }}

{{- if (not site.Params.disableScrollToTop) }}
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
    <path d="M12 6H0l6-6z" />
  </svg>
</a>
{{- end }}

{{- partial "extend_footer.html" . }}

{{- /* Search */}}
{{- if (eq .Layout `search`) -}}
<link crossorigin="anonymous" rel="preload" as="fetch" href="/index.json">
{{- $fastsearch := resources.Get "js/fastsearch.js" | js.Build (dict "params" (dict "fuseOpts" site.Params.fuseOpts)) }}
{{- $fusejs := resources.Get "js/fuse.basic.min.js" }}
{{- $search := (slice $fusejs $fastsearch ) | resources.Concat "assets/js/search.js" | minify }}
<script defer crossorigin="anonymous" src="{{ $search.RelPermalink }}"></script>
{{- end }}

<script>
  (function() {
    /* theme toggle */
    const disableThemeToggle = '{{ if site.Params.disableThemeToggle }}1{{ end }}' == '1';
    if (disableThemeToggle) {
      return;
    }

    let button = document.getElementById("theme-toggle")
    // remove the listeners first to prevent adding duplicated listener when history goes back and forth
    button.removeEventListener('click', toggleThemeListener)
    // listen to toggle button
    button.addEventListener('click', toggleThemeListener)
  })();
</script>
